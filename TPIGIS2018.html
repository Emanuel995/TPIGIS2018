<!doctype html>
<html lang="en">
<head >
    <!-- archivo CSS con los estilos propios de OpenLayers (href con ruta relativa) -->
<link rel="stylesheet" href="ol4/css/ol.css" type="text/css">
<link rel="stylesheet" href="css/bootstrap.min.css"> 
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script> -->
<script src="js/bootstrap.min.js"></script> 
<script src="jquery.min.js" type="text/javascript"></script>
<script src="ol4/build/ol.js" type="text/javascript"></script>
<script src="url.js" type="text/javascript"></script>
<script>
    var NombreCapas = [
        "puente_red_vial_puntos","puntos_de_alturas_topograficas","puntos_del_terreno","salvado_de_obstaculo",
        "senalizaciones","otras_edificaciones","estructuras_portuarias","infraestructura_aeroportuaria_punto","infraestructura_hidro",
        "actividades_agropecuarias","actividades_economicas","complejo_de_energia_ene","edif_construcciones_turisticas","edif_depor_y_esparcimiento",
        "edif_educacion","edif_religiosos","edificio_de_salud_ips","edificio_publico_ips","edificios_ferroviarios","localidades",
        "marcas_y_senales","obra_de_comunicacion","obra_portuaria","red_ferroviaria","red_vial","vias_secundarias","curso_de_agua_hid",
        "curvas_de_nivel","lineas_de_conduccion_ene","muro_embalse","limite_politico_administrativo_lim","espejo_de_agua_hid",
        "ejido","isla","sue_congelado","sue_consolidado","sue_costero","sue_hidromorfologico","sue_no_consolidado","veg_arborea",
        "veg_arbustiva","veg_cultivos","veg_hidrofila","veg_suelo_desnudo"
    ]
    var TituloCapas = [
        "Puente Red Vial","Alturas Topograficas","Puntos Del Terreno","Salvado De Obstaculo","Senalizaciones",
        "Otras Edificaciones","Estructuras Portuarias","Infraestructura Aeroportuaria","Infraestructura Hidrologica","Actividades Agropecuarias",
        "Actividades Economicas","Complejo De Energia","Edificios Contrucciones y Turisticas","Edificios Deporivos y Esparcimiento",
        "Edificios Educativos","Edificios Religiosos","Edificios de Salud","Edificios Publicos","Edificios Ferroviarios",
        "Localidades","Marcas y senales","Obra de Comunicacion","Obra Portuaria","Red Ferroviaria","Red Vial","Vias Secundarias",
        "Curso de agua","Curvas de nivel","Lineas de conduccion","Muro de embalse","Limite politico administrativo","Espejo de agua",
        "Ejido","Isla","Suelo congelado","Suelo consolidado","Suelo costero","Suelo hidromorfologico","Suelo no consolidado",
        "Vegetacion arborea","Vegetacion arbustiva","Vegetacion de cultivos","Vegetacion hidrofila","Vegetacion de suelo desnudo"
    ]
</script>
<style>
    /* selector CSS #map: selecciona cualquier elemento con id="map" */
    #map {
        height: 600px;	/* alto del elemento = 400px */
        width: 1200px;	/* ancho del elemento = 100% de su elemento contenedor */
        border: 1px solid; /* borde 1px */
        padding-right: 1%;
        padding-right: 1%;
    }
</style>
<style>
        .divScroll {
        overflow:scroll;
        height:450px;
        width:275px;
    }
</style>
<style>
    .flex-container {
        display: flex;
        align-items: stretch;
    }
    .flex-container > div {
        width: 3000px;
        padding-left: 2%;
        ;
        }

    </style>
<title>Trabajo Practico Integrador GIS 2018</title>
<!-- <div class="jumbotron bg-secondary text-white "> -->
<style>
    #Encabezado{
        max-width: 5000px !important;
        max-height: 75px !important;
        padding-top: 1%;
    }
    #Pie{
        max-width: 5000px !important;
        max-height: 70px !important;
        padding-top:2%;
        padding-bottom:2%;
    }
</style>
<div id = "Encabezado" class = "jumbotron bg-secondary text-white">
    <h1 class="align-top"><img src="imagenes/soyelmapa.jpeg" width="75" height="75"> Trabajo Practico Integrador GIS 2018 - UTN FRRe</h1>
</div>
</head>

<body class="bg-secondary">
<!-- DIV que contiene el mapa -->
<div class="flex-container">
    <div class=row>
            <div class="flex-grow: 2" id="panel">
                    <!-- Radio buttons para cambiar las interacciones activas -->
                    <h3>Controles</h3>
                    <!-- evento onchange: ejecuta la funcion seleccionarControl -->
                    <input
                        type="radio"
                        name="controles"
                        id="controles_navegacion"
                        value="navegacion"
                        checked="checked"
                        onchange="seleccionarControl(this)"
        
                    > <label for="controles_navegacion"> Navegacion</label><br/>
                    <input
                        type="radio"
                        name="controles"
                        id="controles_consulta"
                        value="consulta"
                        onchange="seleccionarControl(this)"
                        > <label for="controles_consulta"> Consulta</label><br/>
                    <h3>Capas</h3>
                    <div class="divScroll">
                    <script>
                        //Cargamos la capas
                        for (i = 0; i < TituloCapas.length; i++){ 
                            var layer = ""                           
                            Titulo = TituloCapas[i];
                            layer = "check_layer_"+(i+1);
                            text = "<input type=checkbox id="+layer+"><label for="+layer+">"+Titulo+"</label><br/>";
                            document.write(text)
                        }
                    </script>
                    </div>
        
                </div>
        <div class="flex-grow: 8 bg-white" id="map" ></div>
        
    </div>
</div>

<div id = "Pie" class="jumbotron  bg-secondary text-white" >
    <h5 class="font-weight-bold text-center" class="d-flex align-items-center justify-content-center"> BEJARANO Evelyn -- GUOUMAN Emiliano -- HUERGA Emanuel</h5>
</div>

<script src="GenerarVarCapas.js"></script>
<script>
// definicion del mapa y su capa
        var map = new ol.Map({
            target: 'map',                
            layers: [
                new ol.layer.Tile({
                    title: "Natural Earth Base Map",
                    source: new ol.source.TileWMS({
                        url: URL_OGC,
                        params: {//parametros del servicio WMS
                            LAYERS: 'pais_lim', //capa(s) del servicio WMS
                            VERSION: '1.1.1' //version del estandar WMS
                        }
                    })
                }),
                    puente_red_vial_puntos,
                    puntos_de_alturas_topograficas,
                    puntos_del_terreno,
                    salvado_de_obstaculo,
                    senalizaciones,
                    otras_edificaciones,
                    estructuras_portuarias,
                    infraestructura_aeroportuaria_punto,
                    infraestructura_hidro,
                    actividades_agropecuarias,
                    actividades_economicas,
                    complejo_de_energia_ene,
                    edif_construcciones_turisticas,
                    edif_depor_y_esparcimiento,
                    edif_educacion,
                    edif_religiosos,
                    edificio_de_salud_ips,
                    edificio_publico_ips,
                    edificios_ferroviarios,
                    localidades,
                    marcas_y_senales,
                    obra_de_comunicacion,
                    obra_portuaria,
                    red_ferroviaria,
                    red_vial,
                    vias_secundarias,
                    curso_de_agua_hid,
                    curvas_de_nivel,
                    lineas_de_conduccion_ene,
                    muro_embalse,
                    limite_politico_administrativo_lim,
                    espejo_de_agua,
                    ejido,
                    isla,
                    sue_congelado,
                    sue_consolidado,
                    sue_costero,
                    sue_hidromorfologico,
                    sue_no_consolidado,
                    veg_arborea,
                    veg_arbustiva,
                    veg_cultivos,
                    veg_hidrofila,
                    veg_suelo_desnudo
            ],
            view: new ol.View({
                projection: 'EPSG:4326',
                center: [-60, -26.5],
                zoom: 7
             })
         });
        
         //function que va a realizar la peticion de la consulta
        var consultar = function(coordinate){
            console.log(coordinate);
            if(coordinate.length==2){
                //es un punto [lon,lat]
                var wkt='POINT('+coordinate[0]+' ' +coordinate[1]+')';
            }else{
                //es un poligono en la forma [ [ [lon,lat],[lon,lat],....] ]
                var wkt = 'POLYGON((';
                for(var i=0;i<coordinate[0].length - 1;i++){
                    wkt+=coordinate[0][i][0]+ ' ' + coordinate[0][i][1]+ ',';
                }
                wkt+=coordinate[0][0][0]+' '+coordinate[0][0][1]+'))'
            }
            console.log(wkt);
            window.open('consulta.php?wkt='+wkt);return;
                // jQuery.ajax({
                //     url:'consulta.php',
                //     method: 'GET',
                //     data:{
                //         wkt:wkt
                //     },
                //     success:function(data){
                //         console.log(data);
                //     }
                // });
        };
        //Interaccion para crear un dragbox
        var selectInteraction = new ol.interaction.DragBox(
                {
                //condicion mediante la cual se activa la interaccion
                condition: ol.events.condition.always, 
                //estilo del rectangulo a dibujar (el dragbox)
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: [255, 0, 0, 1]
                    })
                })
                }
        );
        selectInteraction.on('boxend', function (evt) {
            //mando por consola las coordenadas de la geometria creada
            console.log('boxend', selectInteraction.getGeometry().getCoordinates());
            //consulta en funcion de las coordenadas del dragbox
            consultar(selectInteraction.getGeometry().getCoordinates());
        });
        //funcion para el evento click en el mapa
        var clickEnMapa = function (evt) {
            //muestro por consola las coordenadas del evento
            console.log('click',evt.coordinate);
            //consulta en funcion de un punto
            consultar(evt.coordinate);
        };
        //function para "cambiar" de interaction en function del value de los radios
        var seleccionarControl = function (el) {
            if (el.value == "consulta") {
                //agrego la interaccion del dragbox
                //la cual tiene precedencia sobre las otras
                map.addInteraction(selectInteraction);
                //subscribo una funcion al evento click del mapa
                map.on('click', clickEnMapa);
            } else if (el.value == "navegacion") {
                //la remuevo...
                map.removeInteraction(selectInteraction);
                map.un('click', clickEnMapa);
            }
            //muestro por consola el valor
            console.log(el.value);
        };
</script>      
<script src="GenerarCheckbox.js">
/*
//Generador de codigo para las VARIABLES de los checkbox

    for (i = 0; i < NombreCapas.length; i++){
        text=       "var checkbox"+(i+1)+" = document.getElementById('check_layer_"+(i+1)+"');<br/>"+
                    "checkbox"+(i+1)+".addEventListener('change',function() {<br/>"+
                    "var checked = this.checked;<br/>"+
                    "if (checked !== "+NombreCapas[i]+".getVisible()){<br/>"+
                    NombreCapas[i]+".setVisible(checked);<br/>"+
                    "}<br/>"+
                "});<br/>"+
                NombreCapas[i]+".on('change:visible', function(){<br/>"+
                    "var visible = this.getVisible();<br/>"+
                    "if (visible !== checkbox"+(i+1)+".checked){<br/>"+
                        "checkbox"+(i+1)+".checked = visible;<br/>"+
                    "}<br/>"+
                "});"+"<br/>"
        document.write(text)        
            };
*/     
</script>
</body>
</html>